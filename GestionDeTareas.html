<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gesti贸n de Tareas</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
  <link
    rel="stylesheet"
    as="style"
    onload="this.rel='stylesheet'"
    href="https://fonts.googleapis.com/css2?display=swap&family=Inter:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900"
  />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
</head>
<body class="font-sans bg-slate-50 text-[#0d141c]">

  <!-- NAVBAR -->
  <nav class="bg-gray-900 text-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <a href="index.html" class="flex items-center text-xl font-bold">Unitask</a>
        <div class="hidden sm:flex sm:items-center space-x-4">
          <a href="CalendarioIntegrado.html" class="hover:text-gray-300">Calendario</a>
          <a href="DetalleDeProyectos.html" class="hover:text-gray-300">Detalle de Proyectos</a>
          <a href="GestionDeTareas.html" class="hover:text-gray-300">Gesti贸n de Tareas</a>
          <a href="ListaDeProyectos.html" class="hover:text-gray-300">Lista de Proyectos</a>
          <a href="PanelDeControl.html" class="hover:text-gray-300">Panel de Control</a>
          <a href="PerfilDeUsuario.html" class="hover:text-gray-300">Perfil de Usuario</a>
        </div>
        <button id="menu-toggle" class="sm:hidden text-gray-300">
          <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
      <div id="menu-mobile" class="sm:hidden hidden mt-2 space-y-1">
        <a href="CalendarioIntegrado.html" class="block py-2 px-4 hover:bg-gray-800">Calendario</a>
        <a href="DetalleDeProyectos.html" class="block py-2 px-4 hover:bg-gray-800">Detalle de Proyectos</a>
        <a href="GestionDeTareas.html" class="block py-2 px-4 hover:bg-gray-800">Gesti贸n de Tareas</a>
        <a href="ListaDeProyectos.html" class="block py-2 px-4 hover:bg-gray-800">Lista de Proyectos</a>
        <a href="PanelDeControl.html" class="block py-2 px-4 hover:bg-gray-800">Panel de Control</a>
        <a href="PerfilDeUsuario.html" class="block py-2 px-4 hover:bg-gray-800">Perfil de Usuario</a>
      </div>
    </div>
  </nav>
  <script>
    const btn = document.getElementById('menu-toggle'),
          menuMobile = document.getElementById('menu-mobile');
    btn.addEventListener('click', () => menuMobile.classList.toggle('hidden'));
  </script>

  <!-- CONTENIDO PRINCIPAL -->
  <div class="flex min-h-screen flex-col overflow-x-hidden">

    <!-- HEADER -->
    <header class="flex items-center justify-between border-b border-[#e7edf4] px-10 py-4">
      <h1 class="text-2xl font-bold">Tareas</h1>
      <div class="flex items-center gap-4">
        <input
          id="search-input"
          type="text"
          placeholder="Buscar tareas"
          class="rounded-lg bg-[#e7edf4] px-4 py-2 text-[#49739c] focus:outline-none"
        />
        <button
          id="create-task-btn"
          class="rounded-lg bg-[#e7edf4] px-4 py-2 text-[#0d141c] font-medium"
        >
          Nueva tarea
        </button>
      </div>
    </header>

    <!-- FILTROS -->
    <div class="px-10 py-3 flex gap-3 flex-wrap">
      <button class="rounded-lg bg-[#e7edf4] px-4 py-2">Todas</button>
      <button class="rounded-lg bg-[#e7edf4] px-4 py-2">En progreso</button>
      <button class="rounded-lg bg-[#e7edf4] px-4 py-2">Completadas</button>
      <button class="rounded-lg bg-[#e7edf4] px-4 py-2">Prioritarias</button>
    </div>

    <!-- TABLA -->
    <div class="px-10 pb-10">
      <div class="overflow-hidden rounded-lg border border-[#cedbe8] bg-white">
        <table class="w-full table-fixed">
          <thead class="bg-slate-50">
            <tr>
              <th class="px-4 py-3 text-left w-2/5 text-sm font-medium">Tarea</th>
              <th class="px-4 py-3 text-left w-1/5 text-sm font-medium">Responsable</th>
              <th class="px-4 py-3 text-left w-1/5 text-sm font-medium">Fecha de vencimiento</th>
              <th class="px-4 py-3 text-left w-1/5 text-sm font-medium">Prioridad</th>
              <th class="px-4 py-3 text-left w-1/5 text-sm font-medium">Estado</th>
            </tr>
          </thead>
          <tbody id="tasks-table-body" class="divide-y divide-[#cedbe8]">
            <!-- Se inyectan las tareas desde Firestore -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- FIREBASE + REALTIME + UPDATE DOC -->
  <script type="module">
    import { initializeApp }    from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
    import {
      getFirestore,
      collection,
      onSnapshot,
      addDoc,
      doc,
      updateDoc
    } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';

    // Configuraci贸n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDJk3VXyCHSu6ujdNhLZfgJeUhzl2qsOR4",
      authDomain: "unitask-a35a9.firebaseapp.com",
      projectId: "unitask-a35a9",
      storageBucket: "unitask-a35a9.appspot.com",
      messagingSenderId: "76838238097",
      appId: "1:76838238097:web:1c1620cf3331d7d9f98c30"
    };

    // Inicializa Firebase
    const app       = initializeApp(firebaseConfig);
    const db        = getFirestore(app);
    const tasksCol  = collection(db, 'tareas');
    const tableBody = document.getElementById('tasks-table-body');

    // Clases de color para Estado y Prioridad
    const estadoClasses = {
      'Pendiente':   'bg-red-100 text-red-800',
      'En progreso': 'bg-yellow-100 text-yellow-800',
      'Completada':  'bg-green-100 text-green-800'
    };
    const prioridadClasses = {
      'Alta':  'bg-red-200 text-red-900',
      'Media': 'bg-yellow-200 text-yellow-900',
      'Baja':  'bg-green-200 text-green-900'
    };

    // Listener en tiempo real
    onSnapshot(tasksCol, snapshot => {
      tableBody.innerHTML = '';
      snapshot.forEach(docSnap => {
        const t  = docSnap.data();
        const id = docSnap.id;
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-slate-50';

        tr.innerHTML = `
          <td class="px-4 py-2 text-sm">${t.tarea}</td>
          <td class="px-4 py-2 text-sm">${t.responsable}</td>
          <td class="px-4 py-2 text-sm text-[#49739c]">${t.fechaVencimiento}</td>
          <td class="px-4 py-2">
            <span
              data-id="${id}"
              class="prioridad-badge inline-block px-3 py-1 rounded-full text-xs font-semibold cursor-pointer ${prioridadClasses[t.prioridad]||'bg-gray-100 text-gray-800'}"
            >
              ${t.prioridad}
            </span>
          </td>
          <td class="px-4 py-2">
            <span
              data-id="${id}"
              class="estado-badge inline-block px-3 py-1 rounded-full text-xs font-semibold cursor-pointer ${estadoClasses[t.estado]||'bg-gray-100 text-gray-800'}"
            >
              ${t.estado}
            </span>
          </td>
        `;
        tableBody.appendChild(tr);
      });

      // Editar Estado
      document.querySelectorAll('.estado-badge').forEach(el => {
        el.addEventListener('click', async () => {
          const id    = el.dataset.id;
          const actual= el.textContent;
          const nuevo = prompt('Nuevo estado (Pendiente, En progreso, Completada):', actual);
          if (nuevo && nuevo !== actual) {
            await updateDoc(doc(db, 'tareas', id), { estado: nuevo });
          }
        });
      });

      // Editar Prioridad
      document.querySelectorAll('.prioridad-badge').forEach(el => {
        el.addEventListener('click', async () => {
          const id    = el.dataset.id;
          const actual= el.textContent;
          const nuevo = prompt('Nueva prioridad (Alta, Media, Baja):', actual);
          if (nuevo && nuevo !== actual) {
            await updateDoc(doc(db, 'tareas', id), { prioridad: nuevo });
          }
        });
      });
    });

    // Crear nueva tarea
    document.getElementById('create-task-btn').addEventListener('click', async () => {
      const tarea            = prompt('Nombre de la tarea:');
      if (!tarea) return;
      const responsable      = prompt('Responsable:');
      const fechaVencimiento = prompt('Fecha de vencimiento (dd/mm/yyyy):');
      const prioridad        = prompt('Prioridad (Alta/Media/Baja):', 'Media');
      const estado           = prompt('Estado (Pendiente/En progreso/Completada):', 'Pendiente');
      try {
        await addDoc(tasksCol, { tarea, responsable, fechaVencimiento, prioridad, estado });
      } catch (e) {
        console.error('Error al crear tarea:', e);
        alert('No se pudo crear la tarea. Revisa la consola.');
      }
    });
  </script>
</body>
</html>
