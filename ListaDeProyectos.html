<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lista de Proyectos</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin />
  <link
    rel="stylesheet"
    as="style"
    onload="this.rel='stylesheet'"
    href="https://fonts.googleapis.com/css2?display=swap&family=Inter:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900"
  />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
</head>

<body class="font-sans bg-slate-50 text-[#0d141c]">

  <!-- NAVBAR -->
  <nav class="bg-gray-900 text-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <a href="index.html" class="flex items-center text-xl font-bold">Unitask</a>
        <div class="hidden sm:flex sm:items-center space-x-4">
          <a href="CalendarioIntegrado.html" class="hover:text-gray-300">Calendario</a>
          <a href="DetalleDeProyectos.html" class="hover:text-gray-300">Detalle de Proyectos</a>
          <a href="GestionDeTareas.html" class="hover:text-gray-300">Gestión de Tareas</a>
          <a href="ListaDeProyectos.html" class="hover:text-gray-300">Lista de Proyectos</a>
          <a href="PanelDeControl.html" class="hover:text-gray-300">Panel de Control</a>
          <a href="PerfilDeUsuario.html" class="hover:text-gray-300">Perfil de Usuario</a>
        </div>
        <button id="menu-toggle" class="sm:hidden text-gray-300">
          <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
      <div id="menu-mobile" class="sm:hidden hidden mt-2 space-y-1">
        <a href="CalendarioIntegrado.html" class="block py-2 px-4 hover:bg-gray-800">Calendario</a>
        <a href="DetalleDeProyectos.html" class="block py-2 px-4 hover:bg-gray-800">Detalle de Proyectos</a>
        <a href="GestionDeTareas.html" class="block py-2 px-4 hover:bg-gray-800">Gestión de Tareas</a>
        <a href="ListaDeProyectos.html" class="block py-2 px-4 hover:bg-gray-800">Lista de Proyectos</a>
        <a href="PanelDeControl.html" class="block py-2 px-4 hover:bg-gray-800">Panel de Control</a>
        <a href="PerfilDeUsuario.html" class="block py-2 px-4 hover:bg-gray-800">Perfil de Usuario</a>
      </div>
    </div>
  </nav>
  <script>
    // Toggle menú móvil
    const btn = document.getElementById('menu-toggle'),
          menuMobile = document.getElementById('menu-mobile');
    btn.addEventListener('click', () => menuMobile.classList.toggle('hidden'));
  </script>

  <!-- CONTENIDO PRINCIPAL -->
  <div class="relative flex min-h-screen flex-col overflow-x-hidden">

    <!-- HEADER -->
    <header class="flex items-center justify-between border-b border-[#e7edf4] px-10 py-4">
      <h1 class="text-2xl font-bold">Todos los Proyectos</h1>
      <div class="flex items-center gap-4">
        <input
          id="search-input"
          type="text"
          placeholder="Buscar proyectos"
          class="rounded-lg bg-[#e7edf4] px-4 py-2 text-[#49739c] focus:outline-none"
        />
        <button
          id="create-project-btn"
          class="rounded-lg bg-[#e7edf4] px-4 py-2 text-[#0d141c] font-medium"
        >
          Crear Proyecto
        </button>
      </div>
    </header>

    <!-- FILTROS -->
    <div class="px-10 py-3 flex gap-3 flex-wrap">
      <button class="rounded-lg bg-[#e7edf4] px-4 py-2">Estado</button>
      <button class="rounded-lg bg-[#e7edf4] px-4 py-2">Fecha de inicio</button>
      <button class="rounded-lg bg-[#e7edf4] px-4 py-2">Responsable</button>
    </div>

    <!-- TABLA -->
    <div class="px-10 pb-10">
      <div class="overflow-hidden rounded-lg border border-[#cedbe8] bg-white">
        <table class="w-full table-fixed">
          <thead class="bg-slate-50">
            <tr>
              <th class="px-4 py-3 text-left w-2/5 text-sm font-medium">Nombre del Proyecto</th>
              <th class="px-4 py-3 text-left w-1/5 text-sm font-medium">Estado</th>
              <th class="px-4 py-3 text-left w-1/5 text-sm font-medium">Fecha de Inicio</th>
              <th class="px-4 py-3 text-left w-1/5 text-sm font-medium">Fecha de Finalización</th>
              <th class="px-4 py-3 text-left w-1/5 text-sm font-medium">Responsable</th>
            </tr>
          </thead>
          <tbody id="projects-table-body">
            <!-- Proyectos inyectados por onSnapshot -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- FIREBASE + REALTIME LISTENER -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js';
    import {
      getFirestore,
      collection,
      onSnapshot,
      addDoc
    } from 'https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js';

    // Configuración de tu proyecto Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDJk3VXyCHSu6ujdNhLZfgJeUhzl2qsOR4",
      authDomain: "unitask-a35a9.firebaseapp.com",
      projectId: "unitask-a35a9",
      storageBucket: "unitask-a35a9.firebasestorage.app",
      messagingSenderId: "76838238097",
      appId: "1:76838238097:web:1c1620cf3331d7d9f98c30"
    };

    // Inicializa Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const projectsCol = collection(db, 'proyectos');
    const tableBody = document.getElementById('projects-table-body');

    // Listener en tiempo real: actualiza la tabla al instante
    onSnapshot(projectsCol, snapshot => {
      tableBody.innerHTML = '';
      snapshot.forEach(doc => {
        const p = doc.data();
        const tr = document.createElement('tr');
        tr.className = 'border-t border-[#cedbe8]';
        tr.innerHTML = `
          <td class="px-4 py-2 text-sm">${p.nombre}</td>
          <td class="px-4 py-2 text-sm">
            <button class="rounded-lg px-3 py-1 bg-[#e7edf4] text-[#0d141c]">${p.estado}</button>
          </td>
          <td class="px-4 py-2 text-sm text-[#49739c]">${p.fechaInicio}</td>
          <td class="px-4 py-2 text-sm text-[#49739c]">${p.fechaFin}</td>
          <td class="px-4 py-2 text-sm text-[#49739c]">${p.responsable}</td>
        `;
        tableBody.appendChild(tr);
      });
    });

    // Botón “Crear Proyecto”
    document.getElementById('create-project-btn').addEventListener('click', async () => {
      const nombre      = prompt('Nombre del proyecto:');
      if (!nombre) return;
      const estado      = prompt('Estado:', 'Pendiente');
      const fechaInicio = prompt('Fecha de inicio (dd/mm/yyyy):');
      const fechaFin    = prompt('Fecha de finalización (dd/mm/yyyy):');
      const responsable = prompt('Responsable:');
      await addDoc(projectsCol, { nombre, estado, fechaInicio, fechaFin, responsable });
      // onSnapshot refrescará la tabla automáticamente
    });
  </script>
</body>
</html>
