<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stitch Design</title>
  <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />

  <!-- Fuentes y Tailwind -->
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
  <link
    rel="stylesheet" as="style" onload="this.rel='stylesheet'"
    href="https://fonts.googleapis.com/css2?display=swap&family=Inter:wght@400;500;700;900&family=Noto+Sans:wght@400;500;700;900"
  />
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-slate-50 font-sans">

  <!-- NAVBAR -->
  <nav class="bg-gray-900 text-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <a href="index.html" class="text-xl font-bold">Mi Proyecto</a>
        </div>
        <div class="flex items-center sm:hidden">
          <button id="menu-toggle" class="text-gray-300 focus:outline-none">
            <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
        <div id="menu" class="hidden sm:flex sm:items-center space-x-4">
          <a href="#" class="hover:text-gray-300 flex items-center gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 256 256"><path d="M224,115.55V208a16,16,0,0,1-16,16H168a16,16,0,0,1-16-16V168a8,8,0,0,0-8-8H112a8,8,0,0,0-8,8v40a16,16,0,0,1-16,16H48a16,16,0,0,1-16-16V115.55a16,16,0,0,1,5.17-11.78l80-75.48.11-.11a16,16,0,0,1,21.53,0,1.14,1.14,0,0,0,.11.11l80,75.48A16,16,0,0,1,224,115.55Z"/></svg>
            Mi Panel
          </a>
          <a href="#" class="hover:text-gray-300 flex items-center gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 256 256"><path d="M224,128a8,8,0,0,1-8,8H128a8,8,0,0,1,0-16h88A8,8,0,0,1,224,128ZM128,72h88a8,8,0,0,0,0-16H128a8,8,0,0,0,0,16Zm88,112H128a8,8,0,0,0,0,16h88a8,8,0,0,0,0-16ZM82.34,42.34,56,68.69,45.66,58.34A8,8,0,0,0,34.34,69.66l16,16a8,8,0,0,0,11.32,0l32-32A8,8,0,0,0,82.34,42.34Zm0,64L56,132.69,45.66,122.34a8,8,0,0,0-11.32,11.32l16,16a8,8,0,0,0,11.32,0l32-32a8,8,0,0,0-11.32-11.32Zm0,64L56,196.69,45.66,186.34a8,8,0,0,0-11.32,11.32l16,16a8,8,0,0,0,11.32,0l32-32a8,8,0,0,0-11.32-11.32Z"/></svg>
            Tareas
          </a>
          <!-- resto de links -->
        </div>
      </div>
      <div id="menu-mobile" class="sm:hidden hidden mt-2 space-y-1">
        <a href="#" class="block py-2 px-4 hover:bg-gray-800">Mi Panel</a>
        <a href="#" class="block py-2 px-4 hover:bg-gray-800">Tareas</a>
        <!-- … -->
      </div>
    </div>
    <script>
      document.getElementById('menu-toggle').onclick = () =>
        document.getElementById('menu-mobile').classList.toggle('hidden');
    </script>
  </nav>

  <div class="relative flex min-h-screen flex-col overflow-x-hidden">
    <div class="layout-container flex flex-1 flex-col">
      <div class="gap-1 px-6 flex flex-1 justify-center py-5">

        <!-- PANEL LATERAL -->
        <div class="layout-content-container flex flex-col w-80">
          <!-- tu panel lateral intacto -->
        </div>

        <!-- CONTENIDO PRINCIPAL -->
        <div class="layout-content-container flex flex-col flex-1 max-w-[960px]">

          <!-- TÍTULO -->
          <div class="p-4">
            <p class="text-2xl font-bold text-[#0d141c]">Mi Panel</p>
          </div>

          <!-- RESUMEN DE PROYECTOS -->
          <h2 class="px-4 pt-5 pb-3 text-[22px] font-bold text-[#0d141c]">Resumen de Proyectos</h2>
          <div class="flex flex-wrap gap-4 p-4">
            <div class="flex flex-1 flex-col gap-2 rounded-lg p-6 border border-[#cedbe8]">
              <p>En Progreso</p>
              <p id="count-in-progress" class="text-2xl font-bold">0</p>
            </div>
            <div class="flex flex-1 flex-col gap-2 rounded-lg p-6 border border-[#cedbe8]">
              <p>Completados</p>
              <p id="count-completed" class="text-2xl font-bold">0</p>
            </div>
            <div class="flex flex-1 flex-col gap-2 rounded-lg p-6 border border-[#cedbe8]">
              <p>En Espera</p>
              <p id="count-pending" class="text-2xl font-bold">0</p>
            </div>
            <div class="flex flex-1 flex-col gap-2 rounded-lg p-6 border border-[#cedbe8]">
              <p>Cancelados</p>
              <p id="count-cancelled" class="text-2xl font-bold">0</p>
            </div>
          </div>

          <!-- PRÓXIMAS TAREAS -->
          <h2 class="px-4 pt-5 pb-3 text-[22px] font-bold text-[#0d141c]">Próximas Tareas</h2>
          <div id="upcoming-tasks" class="space-y-2 p-4"></div>

          <!-- ACTIVIDAD RECIENTE -->
          <h2 class="px-4 pt-5 pb-3 text-[22px] font-bold text-[#0d141c]">Actividad Reciente</h2>
          <div id="activity-log" class="space-y-2 p-4"></div>

          <!-- FORMULARIO PARA AÑADIR TAREAS y AGREGAR ARCHIVOS -->
          <div class="p-4 border-t">
            <input id="new-task-title" type="text" placeholder="Título de la tarea"
                   class="w-full mb-2 border p-2 rounded" />
            <input id="new-task-date" type="date"
                   class="w-full mb-2 border p-2 rounded" />

            <!-- Gráfica de tareas por estado -->
            <div class="w-full mb-4">
              <canvas id="taskChart" class="w-full h-64"></canvas>
            </div>

            <!-- Input oculto para archivos -->
            <input id="file-upload" type="file" accept="*/*" multiple hidden />

            <!-- Botón único -->
            <button id="btn-add-task"
                    class="w-full mb-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-500 transition-colors">
              Añadir tarea / archivos
            </button>

            <!-- Importar desde JSON (sigue intacto) -->
            <div class="mt-4 bg-blue-600 p-4 rounded-lg flex flex-col sm:flex-row sm:items-center sm:gap-4">
              <input
                id="import-file"
                type="file"
                accept="application/json"
                class="block w-full text-sm
                       text-gray-200
                       file:mr-4 file:py-2 file:px-4
                       file:rounded-lg file:border-0
                       file:bg-white file:text-gray-800
                       hover:file:bg-gray-100
                       cursor-pointer"
              />
              <button
                id="btn-import"
                class="mt-2 sm:mt-0 px-4 py-2 bg-gray-800 text-white rounded-lg
                       hover:bg-gray-700 transition-colors"
              >
                Importar tareas desde JSON
              </button>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- SCRIPT DE FUNCIONALIDAD -->
  <script>
    const STORAGE_KEY = 'panelState';
    let state = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
      tasks: [
        { id:1, title:'Reunión de inicio', project:'Proyecto A', date:'2025-07-20', status:'in-progress' },
        { id:2, title:'Entrega de diseño', project:'Proyecto B', date:'2025-07-18', status:'in-progress' },
        { id:3, title:'Revisión de presupuesto', project:'Proyecto C', date:'2025-07-17', status:'in-progress' }
      ],
      log: []
    };

    const save = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(state));

    function renderSummary() {
      const cnt = { 'in-progress':0, completed:0, pending:0, cancelled:0 };
      state.tasks.forEach(t => cnt[t.status]++);
      document.getElementById('count-in-progress').textContent = cnt['in-progress'];
      document.getElementById('count-completed').textContent   = cnt.completed;
      document.getElementById('count-pending').textContent     = cnt.pending;
      document.getElementById('count-cancelled').textContent   = cnt.cancelled;
    }

    function renderTasks() {
      const up = document.getElementById('upcoming-tasks');
      up.innerHTML = '';
      state.tasks
        .filter(t => t.status === 'in-progress')
        .sort((a,b)=> new Date(a.date) - new Date(b.date))
        .forEach(t => {
          const d = document.createElement('div');
          d.className = 'flex justify-between p-2 bg-white rounded shadow items-center';
          d.innerHTML = `
            <div>
              <p class="font-semibold text-[#0d141c]">${t.title}</p>
              <p class="text-[#49739c] text-sm">${t.project} – ${t.date}</p>
            </div>
            <div class="flex gap-2">
              <button data-id="${t.id}" data-action="complete"
                      class="px-2 py-1 bg-green-500 text-white rounded">Hecho</button>
              <button data-id="${t.id}" data-action="pending"
                      class="px-2 py-1 bg-yellow-400 text-white rounded">En espera</button>
              <button data-id="${t.id}" data-action="cancel"
                      class="px-2 py-1 bg-red-500 text-white rounded">Cancelar</button>
            </div>`;
          up.appendChild(d);
        });
    }

    function renderLog() {
      const lg = document.getElementById('activity-log');
      lg.innerHTML = '';
      state.log.slice().reverse().forEach(e => {
        const d = document.createElement('div');
        d.className = 'text-sm text-gray-700';
        d.textContent = `[${new Date(e.time).toLocaleTimeString()}] ${e.text}`;
        lg.appendChild(d);
      });
    }

    // ——— Chart.js: tareas por estado ———
    let taskChart = null;
    function updateChart() {
      const ctx = document.getElementById('taskChart').getContext('2d');
      const counts = {
        'En progreso': state.tasks.filter(t=>t.status==='in-progress').length,
        'Completados':   state.tasks.filter(t=>t.status==='completed').length,
        'En espera':     state.tasks.filter(t=>t.status==='pending').length,
        'Cancelados':    state.tasks.filter(t=>t.status==='cancelled').length
      };
      const labels = Object.keys(counts), data = Object.values(counts);
      if (taskChart) {
        taskChart.data.labels = labels;
        taskChart.data.datasets[0].data = data;
        taskChart.update();
      } else {
        taskChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels,
            datasets: [{
              label: 'Tareas por estado',
              data,
              backgroundColor: 'rgba(54, 162, 235, 0.5)',
              borderColor:   'rgba(54, 162, 235, 1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: { beginAtZero: true, ticks: { stepSize: 1 } }
            }
          }
        });
      }
    }

    // Maneja clicks en tareas
    document.getElementById('upcoming-tasks').addEventListener('click', e => {
      const btn = e.target.closest('button[data-id]');
      if (!btn) return;
      const t = state.tasks.find(x => x.id === +btn.dataset.id);
      const act = btn.dataset.action;
      if (act === 'complete') {
        t.status = 'completed';
        state.log.push({time:Date.now(), text:`Tarea "${t.title}" completada.`});
      } else if (act === 'pending') {
        t.status = 'pending';
        state.log.push({time:Date.now(), text:`Tarea "${t.title}" puesta en espera.`});
      } else if (act === 'cancel') {
        t.status = 'cancelled';
        state.log.push({time:Date.now(), text:`Tarea "${t.title}" cancelada.`});
      }
      save(); renderAll();
    });

    // ————————
    // BOTÓN ÚNICO: Añadir tarea o archivos
    // ————————
    const fileInput = document.getElementById('file-upload');
    document.getElementById('btn-add-task').onclick = () => {
      const title = document.getElementById('new-task-title').value.trim();
      const date  = document.getElementById('new-task-date').value;
      // 1) Si falta título o fecha → abrimos selector de archivos
      if (!title || !date) {
        fileInput.value = '';
        fileInput.click();
        return;
      }
      // 2) Si hay título+fecha → añadimos la tarea
      const newId = state.tasks.reduce((mx,t)=>mx>t.id?mx:t.id,0) + 1;
      state.tasks.push({ id:newId, title, project:'General', date, status:'in-progress' });
      state.log.push({ time:Date.now(), text:`Añadida tarea "${title}".` });
      save(); renderAll();
      document.getElementById('new-task-title').value = '';
      document.getElementById('new-task-date').value = '';
    };

    // Cuando el usuario seleccione archivos, procesarlos aquí
    fileInput.onchange = () => {
      Array.from(fileInput.files).forEach(file => {
        state.log.push({
          time: Date.now(),
          text: `Archivo "${file.name}" agregado (${file.type||'desconocido'}).`
        });
        if (file.type==='application/json' || file.name.endsWith('.json')) {
          const reader = new FileReader();
          reader.onload = e => {
            try {
              const arr = JSON.parse(e.target.result);
              if (!Array.isArray(arr)) throw 'No es un arreglo';
              arr.forEach(item => {
                const nid = state.tasks.reduce((mx,t)=>mx>t.id?mx:t.id,0)+1;
                state.tasks.push({
                  id: nid,
                  title: item.title||'Sin título',
                  project: item.project||'General',
                  date: item.date||new Date().toISOString().slice(0,10),
                  status: ['in-progress','completed','pending','cancelled'].includes(item.status)?item.status:'in-progress'
                });
              });
              state.log.push({time:Date.now(),text:`Importadas ${arr.length} tareas desde JSON.`});
              save(); renderAll();
              alert(`Importación: ${arr.length} tareas añadidas.`);
            } catch(err) {
              alert('Error JSON: '+ err);
            }
          };
          reader.readAsText(file);
        }
      });
      fileInput.value = '';
      save(); renderLog();
    };

    // Importar JSON con el botón original (sigue intacto)
    document.getElementById('btn-import').onclick = () => {
      const input = document.getElementById('import-file');
      if (!input.files.length) return alert('Selecciona un archivo JSON');
      const reader = new FileReader();
      reader.onload = e => {
        try {
          const arr = JSON.parse(e.target.result);
          if (!Array.isArray(arr)) throw 'Formato no válido';
          arr.forEach(item => {
            const nid = state.tasks.reduce((m,t)=>m>t.id?m:t.id,0)+1;
            state.tasks.push({
              id: nid,
              title: item.title || 'Sin título',
              project: item.project || 'General',
              date: item.date || new Date().toISOString().slice(0,10),
              status: ['in-progress','completed','pending','cancelled'].includes(item.status)
                      ? item.status : 'in-progress'
            });
          });
          state.log.push({ time:Date.now(), text:`Importadas ${arr.length} tareas desde JSON.`});
          save(); renderAll();
          alert(`Importación exitosa: ${arr.length} tareas añadidas.`);
        } catch(err) {
          console.error(err);
          alert('Error al parsear JSON: ' + err);
        }
      };
      reader.onerror = () => alert('No se pudo leer el archivo');
      reader.readAsText(input.files[0]);
    };

    function renderAll() {
      renderSummary();
      renderTasks();
      renderLog();
      updateChart();
    }

    // Inicial
    renderAll();
  </script>
</body>
</html>