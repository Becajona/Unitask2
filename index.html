<!doctype html>
<html lang="en">
  <head>
    <title>Index</title>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS v5.3.2 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <header>
      <!-- Navbar Bootstrap -->
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
          <a class="navbar-brand" href="index.html">Mi Proyecto</a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item">
                <a class="nav-link" href="CalendarioIntegrado.html">Calendario</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="DetalleDeProyectos.html">Detalle de Proyectos</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="GestionDeTareas.html">Gestión de Tareas</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="ListaDeProyectos.html">Lista de Proyectos</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="PanelDeControl.html">Panel de Control</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="PerfilDeUsuario.html">Perfil de Usuario</a>
              </li>
              <!-- Nuevo enlace a la Matriz de Riesgo -->
              <li class="nav-item">
                <a class="nav-link" href="MatrizdeRiesgo.html">Matriz de Riesgo</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <main class="container mt-5">
      <h1>Bienvenido a Mi Proyecto</h1>
      <p>Usa la barra de navegación para acceder a las diferentes secciones.</p>
    </main>

    <!-- Contenedor para la tabla de proyectos -->
    <tbody id="projects-table-body">
      <!-- Se llenará dinámicamente desde Firestore -->
    </tbody>

    <!-- === SCRIPT FIREBASE === -->
    <script type="module">
      // Firebase imports
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
      import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDJk3VXyCHSu6ujdNhLZfgJeUhzl2qsOR4",
        authDomain: "unitask-a35a9.firebaseapp.com",
        projectId: "unitask-a35a9",
        storageBucket: "unitask-a35a9.appspot.com",
        messagingSenderId: "76838238097",
        appId: "1:76838238097:web:1c1620cf3331d7d9f98c30"
      };

      // Inicializar Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Referencia a colección
      const projectsCol = collection(db, "proyectos");

      // Función para renderizar proyectos
      async function loadProjects() {
        const snapshot = await getDocs(projectsCol);
        const tbody = document.getElementById('projects-table-body');
        tbody.innerHTML = ""; // Limpia tabla

        snapshot.forEach(doc => {
          const p = doc.data();
          const row = document.createElement('tr');
          row.className = "border-top";

          row.innerHTML = `
            <td class="px-4 py-2">${p.nombre}</td>
            <td class="px-4 py-2">${p.estado}</td>
            <td class="px-4 py-2">${p.fechaInicio}</td>
            <td class="px-4 py-2">${p.fechaFin}</td>
            <td class="px-4 py-2">${p.responsable}</td>
          `;
          tbody.appendChild(row);
        });
      }

      // Ejecutar al cargar
      loadProjects();

      // EJEMPLO: Crear proyecto (botón)
      document.querySelector("button:contains('Crear Proyecto')")?.addEventListener("click", async () => {
        await addDoc(projectsCol, {
          nombre: "Nuevo Proyecto",
          estado: "Pendiente",
          fechaInicio: "01/08/2024",
          fechaFin: "31/12/2024",
          responsable: "Usuario Demo"
        });
        loadProjects();
      });
    </script>

    <footer class="bg-dark text-light text-center py-3 mt-5">
      &copy; 2025 Mi Proyecto. Todos los derechos reservados.
    </footer>

    <!-- Bootstrap JS v5.3.2 -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-GomZbc0joezi3PQnjuvEmqzX+0RSBYcq48UJ+OaWKzKSCWMAZfg2f2tMVb0VLGlZ"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
